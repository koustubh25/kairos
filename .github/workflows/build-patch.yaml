name: Build amd64 images (patched versions)
on:
  push:

jobs:
  build: 
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Set up Docker Buildx
        id: buildx
        uses: docker/setup-buildx-action@master
      - name: Install earthly
        uses: Luet-lab/luet-install-action@v1.1
        with:
          repository: quay.io/kairos/packages
          packages: utils/earthly
      - name: Build  ðŸ”§
        run: |
          earthly +iso --VARIANT=standard --K3S_VERSION=latest --FLAVOR=ubuntu --FAMILY=ubuntu --FLAVOR_RELEASE=23.04 --KAIROS_VERSION=v2.4.1 --BASE_IMAGE=ubuntu:23.04 --MODEL=generic
      - uses: actions/upload-artifact@v3
        with:
          name: ubuntu-iso
          path: build/kairos-ubuntu-23.04-standard-amd64-generic-v2.4.1.iso
      